<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro de Dívidas</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">

<style>
  :root {
    --papel: #f4f1ea;
    --grafite: #2d2a26;
    --sepia: #5c5346;
    --sepia-claro: #8a7f70;
    --sangue: #8b2635;
    --sangue-hover: #6d1e29;
    --caneta-azul: #1e3a5f;
    --caneta-azul-hover: #152a47;
    --tinta-fraca: #6b6258;
  }

  * { box-sizing: border-box; }

  body {
    font-family: 'Libre Baskerville', Georgia, serif;
    background: var(--papel);
    color: var(--grafite);
    padding: 2rem;
    min-height: 100vh;
    line-height: 1.6;
    position: relative;
    overflow-x: hidden;
  }

  /* Textura papel + film grain */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    opacity: 0.04;
    pointer-events: none;
    z-index: 9999;
  }

  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background: 
      repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(45, 42, 38, 0.015) 2px,
        rgba(45, 42, 38, 0.015) 4px
      );
    pointer-events: none;
    z-index: 9998;
  }

  h1, h2 {
    font-family: 'Libre Baskerville', Georgia, serif;
    font-weight: 700;
    color: var(--grafite);
  }

  /* Layout brutalista: elementos espalhados */
  .mural {
    position: relative;
  }

  .papel-titulo {
    top: 4rem;
    max-width: 420px;
    padding: 1.2rem 1.8rem;
    background: var(--papel);
    border: 3px solid var(--grafite);
    clip-path: polygon(0 0, 100% 0, 98% 2%, 100% 4%, 97% 100%, 2% 98%, 0 96%, 0 0);
    transform: rotate(-0.8deg);
    box-shadow: 4px 4px 0 var(--grafite);
  }

  .papel-titulo h1 {
    margin: 0;
    font-size: 1.6rem;
    letter-spacing: 0.02em;
  }

  .papel-botao-nova {
    top: 5rem;
    right: 4%;
    transform: rotate(1.2deg);
  }

  .btn-nova-divida {
    padding: 0.9rem 1.8rem;
    background: var(--grafite);
    color: var(--papel);
    border: 2px solid var(--grafite);
    cursor: pointer;
    font-family: 'Libre Baskerville', serif;
    font-weight: 700;
    font-size: 1rem;
    transition: transform 0.15s;
  }

  .btn-nova-divida:hover {
    background: var(--sepia);
    border-color: var(--sepia);
    transform: rotate(-0.5deg) scale(1.02);
  }

  /* Resumos espalhados como post-its */
  .resumo-total {
    top: 12rem;
    left: 2%;
    margin-right: 5%;
    padding: 1rem 1.5rem;
    background: #e8e4d9;
    border: 2px solid var(--grafite);
    clip-path: polygon(0 0, 100% 0, 99% 3%, 100% 6%, 98% 100%, 1% 97%, 0 94%, 0 0);
    transform: rotate(-1.5deg);
  }

  .resumo-pendentes {
    top: 18rem;
    left: 8%;
    margin-right: 3%;
    padding: 1rem 1.5rem;
    background: #f5e8e8;
    border: 2px solid var(--sangue);
    clip-path: polygon(2% 0, 100% 0, 98% 2%, 100% 5%, 97% 100%, 0 98%, 1% 95%, 0 0);
    transform: rotate(1deg);
  }

  .resumo-pagas {
    top: 24rem;
    left: 3%;
    padding: 1rem 1.5rem;
    background: #e6ecf2;
    border: 2px solid var(--caneta-azul);
    clip-path: polygon(0 1%, 100% 0, 98% 3%, 100% 6%, 96% 100%, 2% 98%, 0 96%, 0 0);
    transform: rotate(-0.6deg);
  }

  .total-label {
    font-size: 0.85rem;
    color: var(--sepia);
  }

  .total-value {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 1.4rem;
    font-weight: 500;
    color: var(--grafite);
  }

  .resumo-pendentes .total-value { color: var(--sangue); }
  .resumo-pagas .total-value { color: var(--caneta-azul); }

  /* Filtros como papel recortado */
  .papel-filtros {
    top: 12rem;
    right: 2%;
    padding: 1rem 1.4rem;
    background: #e8e4d9;
    border: 2px solid var(--grafite);
    clip-path: polygon(1% 0, 100% 0, 98% 2%, 100% 5%, 97% 100%, 2% 98%, 0 95%, 0 0);
    rotate: -1.1deg;
  }

  .papel-filtros label {
    font-size: 0.8rem;
    color: var(--sepia);
    display: block;
    margin-bottom: 0.3rem;
  }

  select {
    padding: 0.5rem 0.8rem;
    border: 2px solid var(--grafite);
    background: var(--papel);
    color: var(--grafite);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.85rem;
  }

  .filtros-grid { display: flex; flex-direction: column; gap: 0.8rem; }

  /* Backup */
  .papel-backup {
    right: 0;
    margin-top: 1rem;
    padding: 1.5rem;
    max-width: 380px;
    max-height: 180px;
    background: #e8e4d9;
    border: 2px solid var(--grafite);
    clip-path: polygon(1% 0, 100% 0, 98% 2%, 100% 5%, 97% 100%, 2% 98%, 0 95%, 0 0);
    transform: rotate(-1deg);
  }

  .papel-backup h2 {
    margin: 0 0 0.5rem;
    font-size: 1.1rem;
  }

  .papel-backup p {
    font-size: 0.9rem;
    color: var(--sepia);
    margin-bottom: 1rem;
  }

  .backup-buttons {
    display: flex;
    gap: 0.8rem;
    flex-wrap: wrap;
  }

  .export-btn, .import-btn {
    padding: 0.6rem 1.2rem;
    border: 2px solid var(--grafite);
    background: var(--papel);
    color: var(--grafite);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.85rem;
    cursor: pointer;
  }

  .export-btn:hover, .import-btn:hover {
    background: var(--grafite);
    color: var(--papel);
  }

  #importFile { display: none; }

  .container-header{
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 1rem 2rem;
  }

  .container-resumos {
    display: flex;
    justify-content: center;
    padding: 1rem 2rem;
  }

  .container-acoes {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 30px;
    padding: 1rem 1.4rem;
    background: #e8e4d9;
    border: 2px solid var(--grafite);
    clip-path: polygon(1% 0%, 100% 0, 100% 2%, 100% 10%, 100% 100%, 0% 98%, 0 95%, 0 0);
  }

  /* Mural de post-its (dívidas) */
  .mural-dividas {
    left: 0;
    right: 0;
    bottom: 0;
    padding: 2rem;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 2fr));
    gap: 2rem;
    align-items: start;
  }

  .postit {
    padding: 1.8rem 1.4rem;
    border: 2px solid var(--grafite);
    position: relative;
    min-height: 180px;
    transition: transform 0.2s;
    margin: 2.5rem 0rem;
  }

  .postit:hover { transform: rotate(0deg) translateY(-2px); }

  .postit-pendente {
    background: #fdf0f0;
    clip-path: polygon(0 0, 100% 0, 98% 2%, 100% 5%, 96% 100%, 2% 98%, 0 96%, 1% 2%);
    transform: rotate(var(--r, -1deg));
  }

  .postit-pago {
    background: #eef4fa;
    clip-path: polygon(2% 0, 100% 0, 97% 3%, 100% 6%, 98% 100%, 0 97%, 1% 94%, 0 0);
    transform: rotate(var(--r, 1.2deg));
  }

  .postit-nome {
    font-family: 'Libre Baskerville', serif;
    font-weight: 700;
    font-size: 1rem;
    color: var(--grafite);
    margin-bottom: 0.6rem;
    border-bottom: 1px solid rgba(45,42,38,0.2);
    padding-bottom: 0.4rem;
  }

  .postit-dados {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.85rem;
    color: var(--sepia);
    line-height: 1.7;
  }

  .postit-status {
    font-family: 'IBM Plex Mono', monospace;
    font-weight: 500;
    margin: 0.5rem 0 0.8rem;
  }

  .postit-status.pendente { color: var(--sangue); }
  .postit-status.pago { color: var(--caneta-azul); }

  .postit-obs {
    font-size: 0.75rem;
    color: var(--sepia-claro);
    font-style: italic;
  }

  .postit-acoes {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.8rem;
    padding-top: 0.6rem;
    border-top: 1px solid rgba(45,42,38,0.15);
  }

  .btn-acao {
    padding: 0.4rem 0.8rem;
    font-size: 0.75rem;
    border: 2px solid;
    cursor: pointer;
    font-family: 'IBM Plex Mono', monospace;
  }

  .btn-pagar {
    background: var(--caneta-azul);
    color: var(--papel);
    border-color: var(--caneta-azul);
  }

  .btn-pagar:hover {
    background: var(--caneta-azul-hover);
    border-color: var(--caneta-azul-hover);
  }

  .btn-pago-disabled {
    background: var(--tinta-fraca);
    color: var(--papel);
    border-color: var(--tinta-fraca);
    cursor: default;
  }

  .btn-editar {
    background: var(--sepia);
    color: var(--papel);
    border-color: var(--sepia);
  }

  .btn-editar:hover {
    background: var(--grafite);
    border-color: var(--grafite);
  }

  .btn-excluir {
    background: var(--sangue);
    color: var(--papel);
    border-color: var(--sangue);
  }

  .btn-excluir:hover {
    background: var(--sangue-hover);
    border-color: var(--sangue-hover);
  }

  /* Vazio */
  .mural-vazio {
    grid-column: 1 / -1;
    padding: 3rem;
    text-align: center;
    font-family: 'IBM Plex Mono', monospace;
    color: var(--sepia-claro);
    background: #e8e4d9;
    border: 2px dashed var(--sepia-claro);
  }

  /* Modal */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(45, 42, 38, 0.5);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }

  .modal-overlay.aberto {
    display: flex;
    animation: fadeIn 0.2s ease;
  }

  .modal {
    background: var(--papel);
    border: 3px solid var(--grafite);
    max-width: 520px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    clip-path: polygon(0 0, 100% 0, 98% 2%, 100% 5%, 96% 100%, 2% 98%, 0 96%, 0 0);
    animation: slideUp 0.25s ease;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.2rem 1.5rem;
    border-bottom: 2px solid var(--grafite);
  }

  .modal-header h2 { margin: 0; font-size: 1.2rem; }

  .modal-close {
    background: transparent;
    border: 2px solid var(--grafite);
    color: var(--grafite);
    font-size: 1.4rem;
    cursor: pointer;
    padding: 0.2rem 0.5rem;
    line-height: 1;
  }

  .modal-close:hover {
    background: var(--grafite);
    color: var(--papel);
  }

  .modal-body { padding: 1.5rem; }

  .form-section { margin-bottom: 0; }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }

  .input-group {
    display: flex;
    flex-direction: column;
  }

  .input-group.full { grid-column: 1 / -1; }

  label {
    font-size: 0.85rem;
    color: var(--sepia);
    margin-bottom: 0.3rem;
  }

  input {
    padding: 0.6rem 0.8rem;
    border: 2px solid var(--grafite);
    background: var(--papel);
    color: var(--grafite);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.95rem;
  }

  input:focus {
    outline: none;
    border-color: var(--sepia);
  }

  .modal-buttons {
    display: flex;
    gap: 0.8rem;
    margin-top: 1.2rem;
    flex-wrap: wrap;
  }

  .btn-adicionar {
    padding: 0.7rem 1.4rem;
    background: var(--grafite);
    color: var(--papel);
    border: 2px solid var(--grafite);
    font-family: 'Libre Baskerville', serif;
    font-weight: 700;
    cursor: pointer;
  }

  .btn-adicionar:hover {
    background: var(--sepia);
    border-color: var(--sepia);
  }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @media (max-width: 900px) {
    .papel-titulo, .resumo-total, .resumo-pendentes, .resumo-pagas,
    .papel-filtros, .papel-botao-nova { position: static; transform: none; }
    .mural, .container-header, .container-acoes, .container-resumos { display: flex; flex-direction: column; gap: 1.5rem; }
    .mural-dividas { margin-top: 2rem; }
  }
</style>
</head>

<body>
<div class="mural">
  <div class="container-header">
    <div class="papel-titulo">
      <h1>Registro de Dívidas</h1>
    </div>
  
    <div class="papel-backup">
      <h2>Backup dos Dados</h2>
      <p>Exporte ou importe seu registro</p>
      <div class="backup-buttons">
        <button class="export-btn" onclick="exportarDados()">Exportar</button>
        <button class="import-btn" onclick="document.getElementById('importFile').click()">Importar</button>
        <input type="file" id="importFile" onchange="importarDados(event)" accept=".json">
      </div>
    </div>
  </div>

  <div class="container-resumos">
    <div class="resumo-total">
      <div class="total-label">Total de Dívidas</div>
      <div class="total-value" id="totalDividas">R$ 0,00</div>
    </div>

    <div class="resumo-pendentes">
      <div class="total-label">Pendentes</div>
      <div class="total-value" id="totalPendentes">R$ 0,00</div>
    </div>

    <div class="resumo-pagas">
      <div class="total-label">Pagas</div>
      <div class="total-value" id="totalPagas">R$ 0,00</div>
    </div>
  </div>
  <div class="container-acoes">
    <div class="papel-filtros">
      <div class="filtros-grid">
        <div>
          <label for="filtroStatus">Filtrar</label>
          <select id="filtroStatus">
            <option value="all">Todas</option>
            <option value="pendente">Pendentes</option>
            <option value="pago">Pagas</option>
          </select>
        </div>
        <div>
          <label for="ordenarPor">Ordenar por</label>
          <select id="ordenarPor">
            <option value="data_desc">Data (recentes)</option>
            <option value="data_asc">Data (antigas)</option>
            <option value="valor_desc">Valor (maior)</option>
            <option value="valor_asc">Valor (menor)</option>
            <option value="nome_asc">Nome (A→Z)</option>
            <option value="nome_desc">Nome (Z→A)</option>
            <option value="status_asc">Status (Pend→Pago)</option>
            <option value="status_desc">Status (Pago→Pend)</option>
          </select>
        </div>
      </div>
    </div>

    <div class="papel-botao-nova">
      <button class="btn-nova-divida" onclick="abrirModalNovaDivida()">+ Nova Dívida</button>
    </div>
  </div>
</div>

<div class="mural-dividas" id="listaDividas"></div>

  <!-- Modal do formulário -->
  <div id="modalDivida" class="modal-overlay" onclick="fecharModalSeClicarFora(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2 id="modalTitulo">+ Nova Dívida</h2>
        <button type="button" class="modal-close" onclick="fecharModalDivida()" aria-label="Fechar">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-section">
          <div class="form-grid">
            <div class="input-group">
              <label for="nomeDivida">Nome da Dívida</label>
              <input type="text" id="nomeDivida" placeholder="Ex: Empréstimo Banco X">
            </div>
            <div class="input-group">
              <label for="valorObtido">Valor Obtido (R$)</label>
              <input type="number" step="0.01" id="valorObtido" placeholder="0.00">
            </div>
            <div class="input-group">
              <label for="quantidadeParcelas">Parcelas</label>
              <input type="number" id="quantidadeParcelas" placeholder="0">
            </div>
            <div class="input-group">
              <label for="valorMensal">Valor Mensal (R$)</label>
              <input type="number" step="0.01" id="valorMensal" placeholder="0.00">
            </div>
          </div>
          <div class="input-group full">
            <label for="valorTotal">Valor Total (R$)</label>
            <input type="number" step="0.01" id="valorTotal" placeholder="0.00">
          </div>
          <div class="input-group full">
            <label for="observacao">Observação</label>
            <input type="text" id="observacao" placeholder="Detalhes, data do empréstimo...">
          </div>
          <input type="hidden" id="editingId" value="">
          <div class="modal-buttons">
            <button id="btnAdicionar" class="btn-adicionar" onclick="adicionarDivida()">+ Adicionar Dívida</button>
            <button id="btnCancelarEdicao" class="btn-adicionar" style="background:#6b6258; border-color:#6b6258; display:none;" onclick="fecharModalDivida()">Cancelar</button>
            <button type="button" class="btn-adicionar" style="background:transparent; color:var(--grafite);" onclick="fecharModalDivida()">Fechar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
// Carregar dívidas do localStorage ou iniciar array vazio
let dividas = JSON.parse(localStorage.getItem('registroDividas')) || [];

// Função para atualizar totais
function atualizarTotais() {
  let totalDividas = 0;
  let totalPendentes = 0;
  let totalPagas = 0;
  
  dividas.forEach(divida => {
    const valorTotalDivida = Number(divida.valorTotal) || (Number(divida.valorMensal) * Number(divida.quantidadeParcelas)) || Number(divida.valorObtido) || 0;
    totalDividas += valorTotalDivida;

    if (divida.status === 'pendente') {
      totalPendentes += valorTotalDivida;
    } else {
      totalPagas += valorTotalDivida;
    }
  });
  
  document.getElementById('totalDividas').textContent = `R$ ${totalDividas.toFixed(2).replace('.', ',')}`;
  document.getElementById('totalPendentes').textContent = `R$ ${totalPendentes.toFixed(2).replace('.', ',')}`;
  document.getElementById('totalPagas').textContent = `R$ ${totalPagas.toFixed(2).replace('.', ',')}`;
}

// Função para adicionar nova dívida
function adicionarDivida() {
  const nome = document.getElementById('nomeDivida').value.trim();
  const valorObtido = parseFloat(document.getElementById('valorObtido').value);
  const quantidadeParcelas = parseInt(document.getElementById('quantidadeParcelas').value);
  const valorMensal = parseFloat(document.getElementById('valorMensal').value);
  const observacao = document.getElementById('observacao').value.trim();
  const editingId = document.getElementById('editingId').value;

  // Calcular valor total com segurança (parcelas * valor mensal)
  const inputValorTotal = document.getElementById('valorTotal');
  const valorTotalCalc = (Number(valorMensal) || 0) * (Number(quantidadeParcelas) || 0);
  const valorTotal = Number(inputValorTotal.value) || valorTotalCalc;

  // Validação
  if (!nome) {
    alert('Por favor, informe o nome da dívida');
    return;
  }
  
  if (!valorObtido || valorObtido <= 0) {
    alert('Por favor, informe um valor total válido');
    return;
  }
  
  if (!quantidadeParcelas || quantidadeParcelas <= 0) {
    alert('Por favor, informe uma quantidade de parcelas válida');
    return;
  }
  
  if (!valorMensal || valorMensal <= 0) {
    alert('Por favor, informe um valor mensal válido');
    return;
  }

  // Se estiver editando, atualiza a dívida existente
  if (editingId) {
    const idNum = Number(editingId);
    const index = dividas.findIndex(d => d.id === idNum);
    if (index !== -1) {
      dividas[index].nome = nome;
      dividas[index].valorObtido = valorObtido;
      dividas[index].quantidadeParcelas = quantidadeParcelas;
      dividas[index].valorMensal = valorMensal;
      dividas[index].valorTotal = valorTotal;
      dividas[index].observacao = observacao || 'Sem observação';
      dividas[index].dataAtualizacao = new Date().toISOString();

      salvarDados();
      atualizarLista();
      atualizarTotais();
      limparFormulario();
      document.getElementById('editingId').value = '';
      document.getElementById('btnAdicionar').textContent = '+ Adicionar Dívida';
      document.getElementById('btnCancelarEdicao').style.display = 'none';
      fecharModalDivida();
      alert('Dívida atualizada com sucesso!');
      return;
    } else {
      alert('Não foi possível encontrar a dívida para edição.');
      document.getElementById('editingId').value = '';
    }
  }

  // Criar nova dívida
  const novaDivida = {
    id: Date.now(), // ID único baseado no timestamp
    nome: nome,
    valorObtido: valorObtido,
    quantidadeParcelas: quantidadeParcelas,
    valorMensal: valorMensal,
    valorTotal: valorTotal,
    observacao: observacao || 'Sem observação',
    status: 'pendente', // pendente ou pago
    dataCriacao: new Date().toISOString()
  };

  // Adicionar ao array
  dividas.push(novaDivida);
  
  // Salvar no localStorage
  salvarDados();
  
  // Atualizar a interface
  atualizarLista();
  atualizarTotais();
  
  // Limpar campos do formulário e fechar modal
  limparFormulario();
  fecharModalDivida();
  
  alert('Dívida registrada com sucesso!');
}

// Função para atualizar a lista na interface (post-its)
function atualizarLista() {
  const container = document.getElementById('listaDividas');

  const filtro = document.getElementById('filtroStatus') ? document.getElementById('filtroStatus').value : 'all';
  const ordenacao = document.getElementById('ordenarPor') ? document.getElementById('ordenarPor').value : 'data_desc';

  let lista = dividas.slice();

  if (filtro !== 'all') {
    lista = lista.filter(d => d.status === filtro);
  }

  const obterValor = d => Number(d.valorTotal) || (Number(d.valorMensal) * Number(d.quantidadeParcelas)) || Number(d.valorObtido) || 0;

  switch (ordenacao) {
    case 'data_desc':
      lista.sort((a, b) => new Date(b.dataCriacao) - new Date(a.dataCriacao));
      break;
    case 'data_asc':
      lista.sort((a, b) => new Date(a.dataCriacao) - new Date(b.dataCriacao));
      break;
    case 'valor_desc':
      lista.sort((a, b) => obterValor(b) - obterValor(a));
      break;
    case 'valor_asc':
      lista.sort((a, b) => obterValor(a) - obterValor(b));
      break;
    case 'nome_asc':
      lista.sort((a, b) => String(a.nome).localeCompare(String(b.nome)));
      break;
    case 'nome_desc':
      lista.sort((a, b) => String(b.nome).localeCompare(String(a.nome)));
      break;
    case 'status_asc':
      lista.sort((a, b) => (a.status === b.status) ? 0 : (a.status === 'pendente' ? -1 : 1));
      break;
    case 'status_desc':
      lista.sort((a, b) => (a.status === b.status) ? 0 : (a.status === 'pago' ? -1 : 1));
      break;
    default:
      break;
  }

  if (lista.length === 0) {
    container.innerHTML = '<div class="mural-vazio">Nenhuma dívida encontrada com os filtros atuais.</div>';
    return;
  }

  const rotacoes = ['-1.2deg', '0.8deg', '-0.5deg', '1.5deg', '-1deg', '1.8deg'];
  let html = '';
  lista.forEach((divida, i) => {
    const r = rotacoes[i % rotacoes.length];
    const postitClass = divida.status === 'pendente' ? 'postit postit-pendente' : 'postit postit-pago';
    const statusClass = divida.status === 'pendente' ? 'pendente' : 'pago';
    const statusText = divida.status === 'pendente' ? 'Pendente' : 'Pago';
    const valorObtido = `R$ ${Number(divida.valorObtido).toFixed(2).replace('.', ',')}`;
    const valorMensal = `R$ ${Number(divida.valorMensal).toFixed(2).replace('.', ',')}`;
    const valorTotalFormatado = `R$ ${Number(divida.valorTotal || (divida.valorMensal * divida.quantidadeParcelas) || 0).toFixed(2).replace('.', ',')}`;

    html += `
      <div class="${postitClass}" style="--r: ${r}">
        <div class="postit-nome">${divida.nome}</div>
        <div class="postit-dados">
          Obtido: ${valorObtido} | ${divida.quantidadeParcelas}x de ${valorMensal}<br>
          Total: ${valorTotalFormatado}
        </div>
        <div class="postit-status ${statusClass}">${statusText}</div>
        ${divida.observacao && divida.observacao !== 'Sem observação' ? `<div class="postit-obs">${divida.observacao}</div>` : ''}
        <div class="postit-acoes">
          ${divida.status === 'pendente'
            ? `<button class="btn-acao btn-pagar" onclick="marcarComoPago(${divida.id})">Pagar</button>`
            : `<button class="btn-acao btn-pago-disabled" disabled>Pago</button>`}
          <button class="btn-acao btn-editar" onclick="editarDivida(${divida.id})">Editar</button>
          <button class="btn-acao btn-excluir" onclick="excluirDivida(${divida.id})">Excluir</button>
        </div>
      </div>
    `;
  });

  container.innerHTML = html;
}

// Função para marcar dívida como paga
function marcarComoPago(id) {
  if (!confirm('Deseja marcar esta dívida como paga?')) return;
  
  const index = dividas.findIndex(d => d.id === id);
  if (index !== -1) {
    dividas[index].status = 'pago';
    dividas[index].dataPagamento = new Date().toISOString();
    salvarDados();
    atualizarLista();
    atualizarTotais();
  }
}

// Função para excluir dívida
function excluirDivida(id) {
  if (!confirm('Tem certeza que deseja excluir esta dívida?')) return;
  
  dividas = dividas.filter(d => d.id !== id);
  salvarDados();
  atualizarLista();
  atualizarTotais();
}

// Função para exportar dados
function exportarDados() {
  if (dividas.length === 0) {
    alert('Não há dados para exportar!');
    return;
  }
  
  const dados = {
    dividas: dividas,
    dataExportacao: new Date().toISOString(),
    totalDividas: dividas.reduce((sum, d) => {
      const v = Number(d.valorTotal) || (Number(d.valorMensal) * Number(d.quantidadeParcelas)) || Number(d.valorObtido) || 0;
      return sum + v;
    }, 0)
  };
  
  const dadosStr = JSON.stringify(dados, null, 2);
  const blob = new Blob([dadosStr], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement('a');
  a.href = url;
  a.download = `registro_dividas_${new Date().toISOString().split('T')[0]}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// Função para importar dados
function importarDados(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  if (!confirm('Importar dados irá substituir as dívidas atuais. Deseja continuar?')) {
    event.target.value = '';
    return;
  }
  
  const reader = new FileReader();
  
  reader.onload = function(e) {
    try {
      const dados = JSON.parse(e.target.result);
      
      if (!dados.dividas || !Array.isArray(dados.dividas)) {
        throw new Error('Formato de arquivo inválido');
      }
      
      dividas = dados.dividas;
      salvarDados();
      atualizarLista();
      atualizarTotais();
      
      alert(`Sucesso! ${dividas.length} dívida(s) importada(s).`);
    } catch (error) {
      alert('Erro ao importar arquivo. Verifique se é um arquivo válido.');
      console.error('Erro na importação:', error);
    }
    
    event.target.value = '';
  };
  
  reader.readAsText(file);
}

// Função para salvar dados no localStorage
function salvarDados() {
  localStorage.setItem('registroDividas', JSON.stringify(dividas));
}

// Função para limpar formulário
function limparFormulario() {
  document.getElementById('nomeDivida').value = '';
  document.getElementById('valorObtido').value = '';
  document.getElementById('quantidadeParcelas').value = '';
  document.getElementById('valorMensal').value = '';
  document.getElementById('observacao').value = '';
  document.getElementById('valorTotal').value = '';
}

// Função para abrir modal (nova dívida)
function abrirModalNovaDivida() {
  document.getElementById('modalTitulo').textContent = '+ Nova Dívida';
  document.getElementById('editingId').value = '';
  document.getElementById('btnAdicionar').textContent = '+ Adicionar Dívida';
  document.getElementById('btnCancelarEdicao').style.display = 'none';
  limparFormulario();
  document.getElementById('modalDivida').classList.add('aberto');
}

// Fechar modal
function fecharModalDivida() {
  document.getElementById('modalDivida').classList.remove('aberto');
  cancelarEdicao();
}

// Fechar modal ao clicar no overlay (fora do conteúdo)
function fecharModalSeClicarFora(event) {
  if (event.target.id === 'modalDivida') {
    fecharModalDivida();
  }
}

// Função para iniciar edição de uma dívida (abre no modal)
function editarDivida(id) {
  const divida = dividas.find(d => d.id === id);
  if (!divida) {
    alert('Dívida não encontrada para edição.');
    return;
  }

  document.getElementById('modalTitulo').textContent = 'Editar Dívida';
  document.getElementById('nomeDivida').value = divida.nome || '';
  document.getElementById('valorObtido').value = Number(divida.valorObtido) || '';
  document.getElementById('quantidadeParcelas').value = divida.quantidadeParcelas || '';
  document.getElementById('valorMensal').value = Number(divida.valorMensal) || '';
  document.getElementById('valorTotal').value = Number(divida.valorTotal) || '';
  document.getElementById('observacao').value = divida.observacao === 'Sem observação' ? '' : (divida.observacao || '');

  document.getElementById('editingId').value = String(divida.id);
  document.getElementById('btnAdicionar').textContent = 'Salvar Alterações';
  document.getElementById('btnCancelarEdicao').style.display = 'inline-block';

  calcularValorTotal();
  document.getElementById('modalDivida').classList.add('aberto');
}

// Função para cancelar edição (só reseta o formulário; não fecha o modal aqui para evitar loop)
function cancelarEdicao() {
  document.getElementById('editingId').value = '';
  limparFormulario();
  document.getElementById('btnAdicionar').textContent = '+ Adicionar Dívida';
  document.getElementById('btnCancelarEdicao').style.display = 'none';
  if (document.getElementById('modalTitulo')) {
    document.getElementById('modalTitulo').textContent = '+ Nova Dívida';
  }
}

// Fechar modal com tecla Escape
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape' && document.getElementById('modalDivida').classList.contains('aberto')) {
    fecharModalDivida();
  }
});

// Inicializar a aplicação
document.addEventListener('DOMContentLoaded', function() {
  atualizarLista();
  atualizarTotais();
});

// Cálculo automático do valor total (parcelas * valor mensal)
function calcularValorTotal() {
  const parcelas = Number(document.getElementById('quantidadeParcelas').value) || 0;
  const valorMensal = Number(document.getElementById('valorMensal').value) || 0;
  const total = parcelas * valorMensal;
  const input = document.getElementById('valorTotal');
  if (input) {
    input.value = total ? total.toFixed(2) : '';
  }
}

document.getElementById('quantidadeParcelas').addEventListener('input', calcularValorTotal);
document.getElementById('valorMensal').addEventListener('input', calcularValorTotal);
// Atualizar lista quando o usuário alterar filtros/ordenação
if (document.getElementById('filtroStatus')) {
  document.getElementById('filtroStatus').addEventListener('change', atualizarLista);
}
if (document.getElementById('ordenarPor')) {
  document.getElementById('ordenarPor').addEventListener('change', atualizarLista);
}
</script>
</body>
</html>